<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="--知寒" type="application/atom+xml" />






<meta name="description" content="shiro1.shiro 是什么1.简介 Apache Shiro是Java的一个安全框架。  Shiro 功能  没有 Spring Security 做的强大，但使用简单，方便，功能满足基本的需求。  Shiro 不仅可以用在javaSE项目，也可以用在JavaEE项目。而Security  只适用于spring 项目。 ​ ​   2.shiro 有什么用功能 Authentication：">
<meta property="og:type" content="article">
<meta property="og:title" content="shiro 入门">
<meta property="og:url" content="http://guozic.github.com/shiro/index.html">
<meta property="og:site_name" content="--知寒">
<meta property="og:description" content="shiro1.shiro 是什么1.简介 Apache Shiro是Java的一个安全框架。  Shiro 功能  没有 Spring Security 做的强大，但使用简单，方便，功能满足基本的需求。  Shiro 不仅可以用在javaSE项目，也可以用在JavaEE项目。而Security  只适用于spring 项目。 ​ ​   2.shiro 有什么用功能 Authentication：">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="e:/教材/知识回顾/shiro/img/1.png">
<meta property="og:image" content="e:/教材/知识回顾/shiro/img/2.png">
<meta property="og:image" content="e:/教材/知识回顾/shiro/img/3.png">
<meta property="og:updated_time" content="2018-06-25T08:54:43.141Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shiro 入门">
<meta name="twitter:description" content="shiro1.shiro 是什么1.简介 Apache Shiro是Java的一个安全框架。  Shiro 功能  没有 Spring Security 做的强大，但使用简单，方便，功能满足基本的需求。  Shiro 不仅可以用在javaSE项目，也可以用在JavaEE项目。而Security  只适用于spring 项目。 ​ ​   2.shiro 有什么用功能 Authentication：">
<meta name="twitter:image" content="e:/教材/知识回顾/shiro/img/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://guozic.github.com/shiro/"/>





  <title>shiro 入门 | --知寒</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/guozic" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">--知寒</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Stay Hungry, Stay Foolish</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://guozic.github.com/shiro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="郭子成">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/guozi.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="--知寒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">shiro 入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-17T11:17:53+08:00">
                2018-03-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="shiro"><a href="#shiro" class="headerlink" title="shiro"></a>shiro</h1><h2 id="1-shiro-是什么"><a href="#1-shiro-是什么" class="headerlink" title="1.shiro 是什么"></a>1.shiro 是什么</h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h3><ul>
<li><p>Apache Shiro是Java的一个安全框架。</p>
</li>
<li><p>Shiro 功能  没有 Spring Security 做的强大，但使用简单，方便，功能满足基本的需求。</p>
</li>
<li><p>Shiro 不仅可以用在javaSE项目，也可以用在JavaEE项目。而Security  只适用于spring 项目。</p>
<p>​</p>
<p>​</p>
</li>
</ul>
<h2 id="2-shiro-有什么用"><a href="#2-shiro-有什么用" class="headerlink" title="2.shiro 有什么用"></a>2.shiro 有什么用</h2><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul>
<li><code>Authentication</code>：身份认证/登录，验证用户是不是拥有相应的身份；</li>
<li><code>Authorization</code>：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能做事情，常见的如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；</li>
<li>Session Manager：会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通JavaSE环境的，也可以是如Web环境的；</li>
<li>Cryptography：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；</li>
<li>Web Support：Web支持，可以非常容易的集成到Web环境；</li>
<li><code>Caching</code>：缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率；</li>
<li>Concurrency：shiro支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</li>
<li>Testing：提供测试支持；</li>
<li>Run As：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；</li>
<li>Remember Me：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登了。</li>
</ul>
<ul>
<li>注意：Shiro不会去维护用户、维护权限，这些需要我们自己去设计/提供，后通过相应的接口注入给Shiro即可。</li>
</ul>
<h2 id="3-从Shiro外部观察"><a href="#3-从Shiro外部观察" class="headerlink" title="3.从Shiro外部观察"></a>3.从Shiro外部观察</h2><p><img src="E:\教材\知识回顾\shiro\img\1.png" alt="执行流程"></p>
<p>ApplicationCode:引用代码  –及程序员写的代码</p>
<h3 id="shiro-的执行流程图解"><a href="#shiro-的执行流程图解" class="headerlink" title="shiro 的执行流程图解"></a>shiro 的执行流程图解</h3><ol>
<li>应用代码是通过Shiro 的 Subject对象来实现 验证和授权。</li>
<li>而Subject对象又将  验证和授权等功能  委托给SecurityManager。</li>
<li>我们需要给SecurityManager注入realm，</li>
<li>从而让SecuriryManager得到合法的用户及其权限进行判断，从而实现 验证授权等功能 </li>
</ol>
<h3 id="Shiro-中对象的简介"><a href="#Shiro-中对象的简介" class="headerlink" title="Shiro 中对象的简介"></a>Shiro 中对象的简介</h3><ul>
<li>Subject :主体(抽象概念)<ul>
<li>与shiro 框架 交互的任何东西都是Subject。</li>
<li>所有Subject都绑定到SecurityManager</li>
<li>主体与Subject 的所有交互都会再委托给SecurityManager </li>
</ul>
</li>
<li>SecurityManager:安全管理器<ul>
<li><strong>SecurityManager 是 Shiro 的核心！！！</strong></li>
<li>SecurityManager管理者所有的Subject,所有与安全有关的操作都会与SecurityManager交互</li>
<li>它负责与后边介绍的其他组件进行交互</li>
</ul>
</li>
<li>realm:<ul>
<li>太抽象，词义很难准确 翻译。（“安全数据源”）</li>
<li>Shiro的所有的安全数据都是在realm 里获取</li>
<li>例如：<ul>
<li>SecurityManager要验证用户身份，那么它需要从Realm获取相应的用户进行比较以确定用户身份是否合法；也需要从Realm得到用户相应的角色/权限进行验证用户是否能进行操作；</li>
<li>可以把Realm看成DataSource，即安全数据源</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="4-从Shiro-内部观察"><a href="#4-从Shiro-内部观察" class="headerlink" title="4.从Shiro 内部观察"></a>4.从Shiro 内部观察</h2><p><img src="E:\教材\知识回顾\shiro\img\2.png" alt="Shiro"></p>
<ul>
<li><strong>Subject</strong>：</li>
<li><ul>
<li>主体，可以看到主体可以是任何可以与应用交互的“用户”；</li>
</ul>
</li>
<li><strong>SecurityManager</strong>：<ul>
<li><strong>管理着所有Subject、且负责进行认证和授权、及会话、缓存的管理。</strong></li>
<li>是Shiro的心脏；所有具体的交互都通过SecurityManager进行控制；</li>
<li>相当于SpringMVC中的DispatcherServlet或者Struts2中的FilterDispatcher；</li>
</ul>
</li>
<li><strong>Authenticator</strong>：</li>
<li><ul>
<li>认证器，负责主体认证的，这是一个扩展点，</li>
<li>如果用户觉得Shiro默认的不好，可以自定义实现，其需要认证策略（Authentication Strategy），即什么情况下算用户认证通过了。</li>
</ul>
</li>
<li><strong>Authrizer</strong>：</li>
<li><ul>
<li>授权器，或者访问控制器，用来决定主体是否有权限进行相应的操作；</li>
<li>即控制着用户能访问应用中的哪些功能；</li>
</ul>
</li>
<li><strong>Realm</strong>：</li>
<li><ul>
<li>可以有1个或多个Realm，可以认为是安全实体数据源，即用于获取安全实体的。</li>
<li>由用户提供。<ul>
<li>注意：Shiro不知道你的用户/权限存储在哪及以何种格式存储；所以我们一般在应用中都需要实现自己的Realm；</li>
</ul>
</li>
<li>可以是JDBC实现，也可以是LDAP实现，或者内存实现等等；</li>
</ul>
</li>
<li><strong>SessionManager</strong>：<ul>
<li>Shiro框架 抽象了一个自己的Session来管理主体与应用之间交互的数据<ul>
<li>这样的话，比如我们在Web环境用，刚开始是一台Web服务器；接着又上了台EJB服务器；这时想把两台服务器的会话数据放到一个地方，这个时候就可以实现自己的分布式会话（如把数据放到Memcached服务器）；</li>
</ul>
</li>
<li>如果写过Servlet就应该知道Session的概念，Session呢需要有人去管理它的生命周期，这个组件就是SessionManager；而Shiro并不仅仅可以用在Web环境，也可以用在如普通的JavaSE环境、EJB等环境；</li>
</ul>
</li>
<li><strong>SessionDAO</strong>：</li>
<li><ul>
<li>数据访问对象，用于会话的CRUD<ul>
<li>比如我们想把Session保存到数据库，那么可以实现自己的SessionDAO，通过如JDBC写到数据库；</li>
<li>比如想把Session放到Memcached中，可以实现自己的Memcached SessionDAO；</li>
<li>另外SessionDAO中可以使用Cache进行缓存，以提高性能；</li>
</ul>
</li>
</ul>
</li>
<li><strong>CacheManager</strong>：<ul>
<li>缓存控制器，来管理如用户、角色、权限等的缓存的；<ul>
<li>因为这些数据基本上很少去改变，放到缓存中后可以提高访问的性能</li>
</ul>
</li>
</ul>
</li>
<li><strong>Cryptography</strong>：<ul>
<li>密码模块，Shiro提高了一些常见的加密组件用于如密码加密/解密的</li>
</ul>
</li>
</ul>
<h2 id="5-Shiro的组件"><a href="#5-Shiro的组件" class="headerlink" title="5.Shiro的组件"></a>5.Shiro的组件</h2><h3 id="1-身份验证"><a href="#1-身份验证" class="headerlink" title="1.身份验证"></a>1.身份验证</h3><ul>
<li>身份认证，就是判断一个用户是否为合法用户的处理过程。===在应用中能证明他写的登录用户名就他本人。    </li>
<li>最常用的简单身份认证方式是系统通过核对用户输入的用户名和口令，看其是否与系统中存储的该用户的用户名和口令一致，来判断用户身份是否正确。<ul>
<li>对于采用<a href="http://baike.baidu.com/view/5628.htm" target="_blank" rel="noopener">指纹</a>等系统，则出示指纹；</li>
<li>对于硬件Key等刷卡系统，则需要刷卡。</li>
<li>例如用户名/密码来证明。</li>
</ul>
</li>
</ul>
<h4 id="1-案例一：Shiro-Maven-spring-注解配置"><a href="#1-案例一：Shiro-Maven-spring-注解配置" class="headerlink" title="1.案例一：Shiro+Maven+spring+注解配置"></a>1.案例一：Shiro+Maven+spring+注解配置</h4><ul>
<li>此案例只完成登录</li>
</ul>
<h5 id="1-执行流程"><a href="#1-执行流程" class="headerlink" title="1.执行流程:"></a>1.执行流程:</h5><ol>
<li><p>页面用户登录填入登录的用户名及密码</p>
</li>
<li><p>action中获取用户名及密码</p>
</li>
<li><p>创建Subject对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>通过带参构造 创建 令牌 token </p>
</li>
<li><ul>
<li>用户token可能不仅仅是用户名/密码，也可能是其他的，例如登录时允许用户使用  用户名/手机号/邮箱   登录</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取身份验证的token  </span></span><br><span class="line">AuthenticationToken token = <span class="keyword">new</span> UsernamePasswordToken(userName, password);</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过Subject 进行验证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subject.login(token);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Subject 将此验证委托给SecurityManager</p>
</li>
<li><p>创建realm，并将realm注入SecurityManager</p>
</li>
<li><p>创建realm</p>
<ol>
<li><p>实现接口 AuthorizingRealm，并实现其两个方法中的认证方法（授权方法 / 认证方法）</p>
</li>
<li><p>从AuthenticationInfo的认证方法带的参数token中获取 用户名 userName</p>
</li>
<li><p>根据userName 查询 数据库，返回user</p>
</li>
<li><p>判断user是否为空</p>
</li>
<li><p>为空返回null，Shiro 框架就知道验证失败，报异常UnknownAccountException</p>
<blockquote>
<p>身份验证失败请捕获AuthenticationException或其子类</p>
<ul>
<li>常见的如<ul>
<li>DisabledAccountException（禁用的帐号）、LockedAccountException（锁定的帐号）、UnknownAccountException（错误的帐号）、ExcessiveAttemptsException（登录失败次数过多）、IncorrectCredentialsException （错误的凭证）、ExpiredCredentialsException（过期的凭证）等</li>
</ul>
</li>
<li>页面的错误消息展示，最好使用如“用户名/密码错误”而不是“用户名错误”/“密码错误”，防止一些恶意用户非法扫描帐号库</li>
</ul>
</blockquote>
<p>​</p>
</li>
<li><p>不为空，则创建AuthenticationInfo的实现，进行密码验证？？</p>
</li>
<li><p>密码验证不通过报异常：IncorrectCredentialsException</p>
</li>
<li><p>密码验证通过则返回AuthenticationInfo的实现</p>
</li>
</ol>
</li>
</ol>
<h5 id="2-代码分析"><a href="#2-代码分析" class="headerlink" title="2.代码分析"></a>2.代码分析</h5><h6 id="依赖导入"><a href="#依赖导入" class="headerlink" title="依赖导入"></a>依赖导入</h6><ul>
<li>核心包shiro-core  囊括了Shiro 所有的模块</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h6><ul>
<li>这里配置的过滤器 要在applicationContext.xml中实现注册<ul>
<li>即–&gt;配置过滤器的时候对应的\<filter-name\>标签的name的值要与 在applicationContext.xml 中的注册shiro框架的工厂类,初始化框架提供的过滤器的name一致</filter-name\></li>
</ul>
</li>
<li>这个过滤器要在struts2的核心过滤器之前配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--过滤器是Spring框架提供,用于整合shiro框架的 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--而且这个过滤器一定要在struts过滤器之前 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 项目启动过程中,在创建DelegatingFilterProxy过滤器的时候,需要应用一个同名的bean,这个bean必须在spring的配置文件中注册 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="applicationContext-xml"><a href="#applicationContext-xml" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h6><ul>
<li>注册—-&gt;web.xml中配置的过滤器</li>
<li>注册—-&gt;注册安全管理器  securityManager</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册shiro框架的工厂类,初始化框架提供的过滤器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shiroFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注入安全管理器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 登录页面 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"/login.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--登录成功以后跳转的页面 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"successUrl"</span> <span class="attr">value</span>=<span class="string">"/index.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 登录失败或者权限不足跳转的页面 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"unauthorizedUrl"</span> <span class="attr">value</span>=<span class="string">"/unauthorized.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 过滤规则 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filterChainDefinitions"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- authc : 框架提供的过滤器,检查权限,如果有权限直接放行,没有权限,拒绝访问 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- anon : 框架提供的过滤器,可以进行匿名访问 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 格式化代码的时候,规则不允许折行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">      /css/* =anon</span><br><span class="line">      /images/* =anon</span><br><span class="line">      /js/** =anon</span><br><span class="line">      /validatecode.jsp* = anon</span><br><span class="line">      /** = authc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--注册安全管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"securityManager"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"realm"</span> <span class="attr">ref</span>=<span class="string">"userRealm"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="java代码"><a href="#java代码" class="headerlink" title="java代码"></a>java代码</h6><p><strong>action</strong></p>
<ul>
<li>通过SecurityUtils.getSubject() 获取Subject对象</li>
<li>通过带参构造，传入用户名及密码，创建令牌token对象</li>
<li>调用Subject验证用户名及密码–&gt;subject.login(token);</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Namespace</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@ParentPackage</span>(<span class="string">"struts-default"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">CommonAction</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">885635712659668664L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserAction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(User.class);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 登录操作</span></span><br><span class="line">  <span class="meta">@Action</span>(value = <span class="string">"userAction_login"</span>,</span><br><span class="line">          results = &#123;</span><br><span class="line">            <span class="meta">@Result</span>(name = <span class="string">"success"</span>, location = <span class="string">"/index.html"</span>,</span><br><span class="line">                    type = <span class="string">"redirect"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(name = <span class="string">"login"</span>, location = <span class="string">"/login.html"</span>,</span><br><span class="line">                    type = <span class="string">"redirect"</span>)&#125;)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String serverCode = (String) ServletActionContext.getRequest()</span><br><span class="line">      .getSession().getAttribute(<span class="string">"key"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotEmpty(serverCode)</span><br><span class="line">        &amp;&amp; StringUtils.isNotEmpty(validateCode)</span><br><span class="line">        &amp;&amp; serverCode.equals(validateCode)) &#123;</span><br><span class="line">      <span class="comment">// subject代表当前的用户</span></span><br><span class="line">      Subject subject = SecurityUtils.getSubject();</span><br><span class="line">      <span class="comment">// 创建令牌</span></span><br><span class="line">      AuthenticationToken token = <span class="keyword">new</span> UsernamePasswordToken(</span><br><span class="line">        getModel().getUsername(), getModel().getPassword());</span><br><span class="line">      <span class="comment">// 框架提供的登录方法</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        subject.login(token);</span><br><span class="line">        User user = (User) subject.getPrincipal();</span><br><span class="line">        <span class="comment">// 把用户存入Session</span></span><br><span class="line">        ServletActionContext.getRequest().getSession()</span><br><span class="line">          .setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">        <span class="keyword">return</span> SUCCESS;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> LOGIN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 使用属性驱动获取用户输入的验证码</span></span><br><span class="line">  <span class="keyword">private</span> String validateCode;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValidateCode</span><span class="params">(String validateCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.validateCode = validateCode;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>realm</strong></p>
<ul>
<li>实现接口doGetAuthenticationInfo，并实现其 验证 方法</li>
<li>通过验证方法的参数token ，获取用户名</li>
<li>通过用户名查找数据库，获取匹配的用户<ul>
<li>若返回的用户为空，则用户名验证失败，抛出对应异常（见上）</li>
</ul>
</li>
<li>返回不为空，则通过带参构造，创建AuthenticationInfo的实现一个类，进行密码校验<ul>
<li>若校验失败，则抛出对应异常（见上）</li>
</ul>
</li>
<li>校验成功，返回创建的实力；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//----------------------- 授权方法</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//-------------------------- 认证方法</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    UsernamePasswordToken usernamePasswordToken =</span><br><span class="line">      (UsernamePasswordToken) token;</span><br><span class="line">    <span class="comment">// 通过用户名查找用户</span></span><br><span class="line">    String username = usernamePasswordToken.getUsername();</span><br><span class="line">    User user = userRepository.findByUsername(username);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// 没找到,抛异常</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> principal the 'primary' principal associated with the specified realm. 身份,一般出入当前用户</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> credentials the credentials that verify the given principal. 凭证,密码(是从数据库中获取到的密码)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> realmName the realm from where the principal and credentials were acquired.</span></span><br><span class="line"><span class="comment">         *        realm的名字</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    AuthenticationInfo info = <span class="keyword">new</span> 	        	SimpleAuthenticationInfo(user,user.getPassword(),getName());</span><br><span class="line">    <span class="comment">// 找到,比对密码,</span></span><br><span class="line">    <span class="comment">// 比对失败 : 抛异常</span></span><br><span class="line">    <span class="comment">// 比对成功 :</span></span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2案例二：Shiro-Maven-ini配置文件"><a href="#2案例二：Shiro-Maven-ini配置文件" class="headerlink" title="2案例二：Shiro+Maven+ini配置文件"></a>2案例二：Shiro+Maven+ini配置文件</h4><ul>
<li>此案例完成登录/退出</li>
</ul>
<h5 id="1-准备用户身份-凭据（shiro-ini）"><a href="#1-准备用户身份-凭据（shiro-ini）" class="headerlink" title="1.准备用户身份/凭据（shiro.ini）"></a>1.准备用户身份/凭据（shiro.ini）</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="attr">zhang</span>=<span class="number">123</span></span><br><span class="line"><span class="attr">wang</span>=<span class="number">123</span></span><br></pre></td></tr></table></figure>
<ul>
<li>此处使用ini配置文件，通过[users]指定了两个主体：zhang/123、wang/123。</li>
</ul>
<h5 id="2-代码测试"><a href="#2-代码测试" class="headerlink" title="2.代码测试"></a>2.代码测试</h5><ul>
<li>（com.github.zhangkaitao.shiro.chapter2.LoginLogoutTest） </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloworld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1、获取SecurityManager工厂，此处使用Ini配置文件初始化SecurityManager</span></span><br><span class="line">    Factory&lt;org.apache.shiro.mgt.SecurityManager&gt; factory =</span><br><span class="line">            <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">"classpath:shiro.ini"</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//------------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment">//2、得到SecurityManager实例 并绑定给SecurityUtils</span></span><br><span class="line">    org.apache.shiro.mgt.SecurityManager securityManager = factory.getInstance();</span><br><span class="line">    SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">  <span class="comment">/*&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="comment">  		类似于，在案例1中applicationContext.xml中注册安全管理器  securityManager</span></span><br><span class="line"><span class="comment"> &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//-----------------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment">//3、得到Subject及创建用户名/密码身份验证Token（即用户身份/凭证）</span></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"zhang"</span>, <span class="string">"123"</span>);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//-------------------------------------------------------------------------------------------</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//4、登录，即身份验证</span></span><br><span class="line">        subject.login(token);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">        <span class="comment">//5、身份验证失败</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Assert.assertEquals(<span class="keyword">true</span>, subject.isAuthenticated()); <span class="comment">//断言用户已经登录</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//6、退出</span></span><br><span class="line">    subject.logout();</span><br><span class="line">&#125;</span><br><span class="line">&amp;nbsp;</span><br></pre></td></tr></table></figure>
<h5 id="3-身份认证流程"><a href="#3-身份认证流程" class="headerlink" title="3.身份认证流程"></a>3.身份认证流程</h5><h6 id="1-自定义Realm实现"><a href="#1-自定义Realm实现" class="headerlink" title="1.自定义Realm实现"></a>1.自定义Realm实现</h6><ul>
<li>（com.github.zhangkaitao.shiro.chapter2.realm.MyRealm1）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRealm1</span> <span class="keyword">implements</span> <span class="title">Realm</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"myrealm1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(AuthenticationToken token)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//仅支持UsernamePasswordToken类型的Token</span></span><br><span class="line">        <span class="keyword">return</span> token <span class="keyword">instanceof</span> UsernamePasswordToken; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthenticationInfo <span class="title">getAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        String username = (String)token.getPrincipal();  <span class="comment">//得到用户名</span></span><br><span class="line">        String password = <span class="keyword">new</span> String((<span class="keyword">char</span>[])token.getCredentials()); <span class="comment">//得到密码</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">"zhang"</span>.equals(username)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAccountException(); <span class="comment">//如果用户名错误</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">"123"</span>.equals(password)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IncorrectCredentialsException(); <span class="comment">//如果密码错误</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果身份认证验证成功，返回一个AuthenticationInfo实现；</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(username, password, getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&amp;nbsp;</span><br></pre></td></tr></table></figure>
<h6 id="2-ini配置文件指定自定义Realm实现"><a href="#2-ini配置文件指定自定义Realm实现" class="headerlink" title="2.ini配置文件指定自定义Realm实现"></a>2.ini配置文件指定自定义Realm实现</h6><ul>
<li>(shiro-realm.ini)</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#声明一个realm  </span></span><br><span class="line"><span class="attr">myRealm1</span>=com.github.zhangkaitao.shiro.chapter2.realm.MyRealm1  </span><br><span class="line"><span class="attr">myRealm2</span>=com.github.zhangkaitao.shiro.chapter2.realm.MyRealm2  </span><br><span class="line"><span class="comment">#指定securityManager的realms实现  </span></span><br><span class="line">securityManager.realms=$myRealm1,$myRealm2</span><br></pre></td></tr></table></figure>
<ul>
<li>securityManager会按照realms指定的顺序进行身份认证。</li>
<li>此处我们使用显示指定顺序的方式指定了Realm的顺序，如果删除“securityManager.realms=$myRealm1,$myRealm2”，那么securityManager会按照realm声明的顺序进行使用（即无需设置realms属性，其会自动发现）。</li>
<li>当我们显示指定realm后，其他没有指定realm将被忽略，如“securityManager.realms=$myRealm1”，那么myRealm2不会被自动设置进去。</li>
</ul>
<ul>
<li><p><strong>Shiro</strong>默认提供的Realm</p>
<p><img src="E:\教材\知识回顾\shiro\img\3.png" alt="realm"></p>
</li>
</ul>
<blockquote>
<ul>
<li><strong>自定义realm一般都是直接继承AuthorizingRealm（授权）即可</strong>；<ul>
<li>其继承了AuthenticatingRealm（即身份验证），而且也间接继承了CachingRealm（带有缓存实现）。其中主要默认实现如下：<ul>
<li>org.apache.shiro.realm.text.IniRealm：<ul>
<li>[users]部分指定用户名/密码及其角色；</li>
<li>[roles]部分指定角色即权限信息；</li>
</ul>
</li>
<li>org.apache.shiro.realm.text.PropertiesRealm：<ul>
<li>user.username=password,role1,role2指定用户名/密码及其角色。</li>
<li>role.role1=permission1,permission2指定角色及权限信息；</li>
</ul>
</li>
<li>org.apache.shiro.realm.jdbc.JdbcRealm：<ul>
<li>通过sql查询相应的信息–&gt;如<ul>
<li>获取用户密码<ul>
<li>“select password from users where username = ?”</li>
</ul>
</li>
<li>获取用户密码及盐<ul>
<li>“select password, password_salt from users where username = ?”；</li>
</ul>
</li>
<li>获取用户角色<ul>
<li>“select role_name from user_roles where username = ?”</li>
</ul>
</li>
<li>获取角色对应的权限信息<ul>
<li>“select permission from roles_permissions where role_name = ?”</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>首先通过new IniSecurityManagerFactory并指定一个ini配置文件来创建一个SecurityManager工厂；</li>
<li>接着获取SecurityManager并绑定到SecurityUtils，这是一个全局设置，设置一次即可；</li>
<li>通过SecurityUtils得到Subject，其会自动绑定到当前线程；如果在web环境在请求结束时需要解除绑定；然后获取身份验证的Token，如用户名/密码；</li>
<li>调用subject.login方法进行登录，其会自动委托给SecurityManager.login方法进行登录；</li>
<li>如果身份验证失败请捕获AuthenticationException或其子类，常见的如： DisabledAccountException（禁用的帐号）、LockedAccountException（锁定的帐号）、<strong>UnknownAccountException</strong>（错误的帐号）、ExcessiveAttemptsException（登录失败次数过多）、<strong>IncorrectCredentialsException</strong> （错误的凭证）、ExpiredCredentialsException（过期的凭证）等，具体请查看其继承关系；对于页面的错误消息展示，最好使用如“用户名/密码错误”而不是“用户名错误”/“密码错误”，防止一些恶意用户非法扫描帐号库；</li>
<li>最后可以调用subject.logout退出，其会自动委托给SecurityManager.logout方法退出。</li>
</ol>
</blockquote>
<h6 id="–-gt-身份验证的步骤"><a href="#–-gt-身份验证的步骤" class="headerlink" title="–&gt;身份验证的步骤"></a>–&gt;身份验证的步骤</h6><ol>
<li>收集用户身份/凭证，即如用户名/密码；</li>
<li>调用Subject.login进行验证登录，如果失败将得到相应的AuthenticationException异常，根据异常提示用户错误信息；否则登录成功；</li>
<li>最后调用Subject.logout进行退出操作。<ol>
<li>自己实现realm，继承 授权的realm –&gt;AuthorizingRealm</li>
<li>实现  验证的方法 doGetAuthenticationInfo（）</li>
<li>获取用户名—-&gt;获取对应的对象</li>
<li>判断  获取的对象是否为空 为空则用户不存在，抛出对应的异常</li>
<li>不为空，则创建  AuthenticationInfo 接口的一个实现simpleAuthenticationInfo（参数一，参数而，参数三）<ol>
<li>参数一：为数据库中获取的用户对象</li>
<li>参数二：为密码</li>
<li>参数三：此方法所在的realm（即自己实现的 realm）</li>
</ol>
</li>
<li>返回创建的 AuthenticationInfo<ol>
<li>若密码不匹配，则会抛出密码错误对应的异常。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="2-授权"><a href="#2-授权" class="headerlink" title="2.授权"></a>2.授权</h3><h4 id="1-权限控制方式"><a href="#1-权限控制方式" class="headerlink" title="1.权限控制方式"></a>1.权限控制方式</h4><h5 id="1-realm进行权限控制"><a href="#1-realm进行权限控制" class="headerlink" title="1.realm进行权限控制"></a>1.realm进行权限控制</h5><ul>
<li>对分页查询快递员这个请求进行 <strong>权限控制</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 权限控制 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 对courierAction_findPage.action这个请求仅限权限控制 --&gt;</span></span><br><span class="line">/courierAction_findPage.action = perms["courierAction_findPage"]</span><br></pre></td></tr></table></figure>
<h5 id="2-注解方式进行权限控制"><a href="#2-注解方式进行权限控制" class="headerlink" title="2.注解方式进行权限控制"></a>2.注解方式进行权限控制</h5><ul>
<li><p>配置applicationContext.xml</p>
<ul>
<li>方式一：（有问题）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"lifecycleBeanPostProcessor"</span><span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.LifecycleBeanPostProcessor"</span>/&gt;</span> </span><br><span class="line"> <span class="comment">&lt;!-- 启用shiro 注解 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>  <span class="attr">depends-on</span>=<span class="string">"lifecycleBeanPostProcessor"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<!-- ===使用注解方式进行权限控制============================== -->
<!-- 1.spring框架提供  基于spring 的动态代理 创建service的动态代理对象 -->
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 开启cglib注解 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyTargetClass"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  <br>  <!-- 2.配置切面 --><br>  <bean class="org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"><br>    <property name="securityManager" ref="securityManager"></property><br>  </bean><br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ​</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- - 方式二：</span><br><span class="line"></span><br><span class="line">  ```xml</span><br><span class="line">  &lt;!-- Shiro生命周期处理器--&gt;  </span><br><span class="line">  &lt;bean id=&quot;lifecycleBeanPostProcessor&quot; class=&quot;org.apache.shiro.spring.LifecycleBeanPostProcessor&quot;/&gt;  </span><br><span class="line"></span><br><span class="line">  &lt;aop:config proxy-target-class=&quot;true&quot;&gt;&lt;/aop:config&gt;  </span><br><span class="line"></span><br><span class="line">  &lt;bean class=&quot;org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor&quot;&gt;  </span><br><span class="line">    &lt;property name=&quot;securityManager&quot; ref=&quot;securityManager&quot;/&gt;  </span><br><span class="line">  &lt;/bean&gt;</span><br></pre></td></tr></table></figure></p>
<p>  ​</p>
<ul>
<li>​</li>
<li>在serviceImpl 层中 需要 权限控制的方法上添加注解@RequiresPermissions(“courierAction_findPage”)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">	 * 分页</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@RequiresPermissions</span>(<span class="string">"courier_findPage"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Courier&gt; <span class="title">findPage</span><span class="params">(Pageable pageable, Specification&lt;Courier&gt; specification)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> courierRepository.findAll(specification, pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-标签方式进行权限控制"><a href="#3-标签方式进行权限控制" class="headerlink" title="3.标签方式进行权限控制"></a>3.标签方式进行权限控制</h5><ul>
<li><p>只能在jsp页面进行权限控制</p>
</li>
<li><p><strong>没有对应的权限，就不展示  页面中的 该内容</strong></p>
</li>
<li><p>控制步骤</p>
<ul>
<li>导入标签库</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">"http://shiro.apache.org/tags"</span> prefix=<span class="string">"shiro"</span>%&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用对应的标签</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 校验用户是否已经认证通过了,只有认证通过,才能看到标签中间的内容 --&gt;</span><br><span class="line">&lt;shiro:authenticated&gt;</span><br><span class="line">  您已经认证通过了</span><br><span class="line">&lt;/shiro:authenticated&gt;</span><br><span class="line"></span><br><span class="line">&lt;hr&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 校验用户是否拥有对应的权限,如果有对应的权限,才能看到标签中间的内容 --&gt;</span><br><span class="line">&lt;shiro:hasPermission name=<span class="string">"courissser_pageQuery"</span>&gt;</span><br><span class="line">  您拥有courier_pageQuery权限</span><br><span class="line">&lt;/shiro:hasPermission&gt;</span><br><span class="line"></span><br><span class="line">&lt;hr&gt;</span><br><span class="line"></span><br><span class="line">&lt;shiro:hasRole name=<span class="string">"admin"</span>&gt;</span><br><span class="line">  您的角色是admin</span><br><span class="line">&lt;/shiro:hasRole&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4编码方式进行权限控制"><a href="#4编码方式进行权限控制" class="headerlink" title="4编码方式进行权限控制"></a>4编码方式进行权限控制</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subject.checkPermission(<span class="string">"courier:delete"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="2-权限控制方式总结"><a href="#2-权限控制方式总结" class="headerlink" title="2.权限控制方式总结"></a>2.权限控制方式总结</h4><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:left">realm方式</th>
<th style="text-align:left">注解方式</th>
<th>标签方式</th>
<th>编程方式（不推荐）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">技术</td>
<td style="text-align:left">Shiro框架提供的过滤器</td>
<td style="text-align:left">cglib动态代理</td>
<td>标签</td>
<td>java代码逻辑</td>
</tr>
<tr>
<td style="text-align:center">表现形式</td>
<td style="text-align:left">在applicationContext.xml中配置拦截规则</td>
<td style="text-align:left">完成applicationContext.xml中配置–&gt;在方法上配置注解</td>
<td>标签</td>
<td>java代码</td>
</tr>
<tr>
<td style="text-align:center">使用场景</td>
<td style="text-align:left">为登录的状态下保护资源</td>
<td style="text-align:left">登录后，对各种功能操作进行校验</td>
<td>动态控制页面元素是否显示</td>
<td>（修改源码）不推荐使用</td>
</tr>
</tbody>
</table>
<h4 id="3给用户添加指定的权限"><a href="#3给用户添加指定的权限" class="headerlink" title="3给用户添加指定的权限"></a>3给用户添加指定的权限</h4><ul>
<li>在用户权限控制中的  授权方法里面进行授权</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 授权</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">  SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">  <span class="comment">// 进行授权</span></span><br><span class="line">  <span class="comment">// 真实项目的话,权限应该是从数据库中查询出来,动态的进行授权</span></span><br><span class="line">  info.addStringPermission(<span class="string">"courierAction_findPage"</span>);</span><br><span class="line">  <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    


<div>
  
    <div>
    
        <div style="text-align:center;color: #555;font-size:14px;">-------------The End-------------</div>
    
</div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/md5加密/" rel="next" title="shiro 加密">
                <i class="fa fa-chevron-left"></i> shiro 加密
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/异常处理返回json/" rel="prev" title="shiro-前后端分离">
                shiro-前后端分离 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjY2OS8xMzIwNA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/guozi.jpg"
                alt="郭子成" />
            
              <p class="site-author-name" itemprop="name">郭子成</p>
              <p class="site-description motion-element" itemprop="description">java spring mybatis </p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/guozic" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="guozizl@163.com" target="_blank" title="邮件">
                      
                        <i class="fa fa-fw fa-globe"></i>邮件</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/zichengguo" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-globe"></i>微博</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://moviejie.net/" title="电影街" target="_blank">电影街</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.shicimingju.com/" title="诗词" target="_blank">诗词</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#shiro"><span class="nav-number">1.</span> <span class="nav-text">shiro</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-shiro-是什么"><span class="nav-number">1.1.</span> <span class="nav-text">1.shiro 是什么</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-简介"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.简介</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-shiro-有什么用"><span class="nav-number">1.2.</span> <span class="nav-text">2.shiro 有什么用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#功能"><span class="nav-number">1.2.1.</span> <span class="nav-text">功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-从Shiro外部观察"><span class="nav-number">1.3.</span> <span class="nav-text">3.从Shiro外部观察</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#shiro-的执行流程图解"><span class="nav-number">1.3.1.</span> <span class="nav-text">shiro 的执行流程图解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shiro-中对象的简介"><span class="nav-number">1.3.2.</span> <span class="nav-text">Shiro 中对象的简介</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-从Shiro-内部观察"><span class="nav-number">1.4.</span> <span class="nav-text">4.从Shiro 内部观察</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Shiro的组件"><span class="nav-number">1.5.</span> <span class="nav-text">5.Shiro的组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-身份验证"><span class="nav-number">1.5.1.</span> <span class="nav-text">1.身份验证</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-案例一：Shiro-Maven-spring-注解配置"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">1.案例一：Shiro+Maven+spring+注解配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-执行流程"><span class="nav-number">1.5.1.1.1.</span> <span class="nav-text">1.执行流程:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-代码分析"><span class="nav-number">1.5.1.1.2.</span> <span class="nav-text">2.代码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#依赖导入"><span class="nav-number">1.5.1.1.2.1.</span> <span class="nav-text">依赖导入</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#web-xml"><span class="nav-number">1.5.1.1.2.2.</span> <span class="nav-text">web.xml</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#applicationContext-xml"><span class="nav-number">1.5.1.1.2.3.</span> <span class="nav-text">applicationContext.xml</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#java代码"><span class="nav-number">1.5.1.1.2.4.</span> <span class="nav-text">java代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2案例二：Shiro-Maven-ini配置文件"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">2案例二：Shiro+Maven+ini配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-准备用户身份-凭据（shiro-ini）"><span class="nav-number">1.5.1.2.1.</span> <span class="nav-text">1.准备用户身份/凭据（shiro.ini）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-代码测试"><span class="nav-number">1.5.1.2.2.</span> <span class="nav-text">2.代码测试</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-身份认证流程"><span class="nav-number">1.5.1.2.3.</span> <span class="nav-text">3.身份认证流程</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-自定义Realm实现"><span class="nav-number">1.5.1.2.3.1.</span> <span class="nav-text">1.自定义Realm实现</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-ini配置文件指定自定义Realm实现"><span class="nav-number">1.5.1.2.3.2.</span> <span class="nav-text">2.ini配置文件指定自定义Realm实现</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#–-gt-身份验证的步骤"><span class="nav-number">1.5.1.2.3.3.</span> <span class="nav-text">–&gt;身份验证的步骤</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-授权"><span class="nav-number">1.5.2.</span> <span class="nav-text">2.授权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-权限控制方式"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">1.权限控制方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-realm进行权限控制"><span class="nav-number">1.5.2.1.1.</span> <span class="nav-text">1.realm进行权限控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-注解方式进行权限控制"><span class="nav-number">1.5.2.1.2.</span> <span class="nav-text">2.注解方式进行权限控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-标签方式进行权限控制"><span class="nav-number">1.5.2.1.3.</span> <span class="nav-text">3.标签方式进行权限控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4编码方式进行权限控制"><span class="nav-number">1.5.2.1.4.</span> <span class="nav-text">4编码方式进行权限控制</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-权限控制方式总结"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">2.权限控制方式总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3给用户添加指定的权限"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">3给用户添加指定的权限</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
    </div>

  </aside>

  <div id="music163player">
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=86 src="//music.163.com/outchain/player?type=2&id=38358214&auto=0&height=66">
    </iframe>
</div>



        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郭子成</span>

  
</div>


  <!--
  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>
-->





        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访问客
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  


  

</body>
</html>
